
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Notebook Submission Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js">
// Excel export helpers
function exportSheet(rows, filename) {
  const ws = XLSX.utils.json_to_sheet(rows);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
  XLSX.writeFile(wb, filename + ".xlsx", {bookType: "xlsx"});
}

// "Download Full Data" button
document.getElementById('export-full').onclick = () => {
  const rows = [];
  events.forEach(e => {
    const k = keyOf(e);
    for (let r = 1; r <= classLists[currentClass].length; r++) {
      const st = dataStore[currentClass][r][k] || {timeliness:'timely',completion:'complete'};
      rows.push({
        Class: currentClass,
        Roll: r,
        Name: classLists[currentClass][r-1],
        Date: e.date,
        Chapter: e.chapter,
        Timeliness: capitalize(st.timeliness),
        Completion: capitalize(st.completion)
      });
    }
  });
  exportSheet(rows, currentClass + "_full_data");
};

// "Download Chapter" button (latest event)
document.getElementById('export-chapter').onclick = () => {
  if (!events.length) return alert('No chapters to export!');
  const e = events[events.length-1];
  const k = keyOf(e);
  const rows = [];
  for (let r = 1; r <= classLists[currentClass].length; r++) {
    const st = dataStore[currentClass][r][k] || {timeliness:'timely',completion:'complete'};
    rows.push({
      Class: currentClass,
      Roll: r,
      Name: classLists[currentClass][r-1],
      Date: e.date,
      Chapter: e.chapter,
      Timeliness: capitalize(st.timeliness),
      Completion: capitalize(st.completion)
    });
  }
  exportSheet(rows, currentClass + "_" + e.chapter.replace(/\s+/g,'_'));
};

</script>
  <script src="classLists_ready.js">
// Excel export helpers
function exportSheet(rows, filename) {
  const ws = XLSX.utils.json_to_sheet(rows);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
  XLSX.writeFile(wb, filename + ".xlsx", {bookType: "xlsx"});
}

// "Download Full Data" button
document.getElementById('export-full').onclick = () => {
  const rows = [];
  events.forEach(e => {
    const k = keyOf(e);
    for (let r = 1; r <= classLists[currentClass].length; r++) {
      const st = dataStore[currentClass][r][k] || {timeliness:'timely',completion:'complete'};
      rows.push({
        Class: currentClass,
        Roll: r,
        Name: classLists[currentClass][r-1],
        Date: e.date,
        Chapter: e.chapter,
        Timeliness: capitalize(st.timeliness),
        Completion: capitalize(st.completion)
      });
    }
  });
  exportSheet(rows, currentClass + "_full_data");
};

// "Download Chapter" button (latest event)
document.getElementById('export-chapter').onclick = () => {
  if (!events.length) return alert('No chapters to export!');
  const e = events[events.length-1];
  const k = keyOf(e);
  const rows = [];
  for (let r = 1; r <= classLists[currentClass].length; r++) {
    const st = dataStore[currentClass][r][k] || {timeliness:'timely',completion:'complete'};
    rows.push({
      Class: currentClass,
      Roll: r,
      Name: classLists[currentClass][r-1],
      Date: e.date,
      Chapter: e.chapter,
      Timeliness: capitalize(st.timeliness),
      Completion: capitalize(st.completion)
    });
  }
  exportSheet(rows, currentClass + "_" + e.chapter.replace(/\s+/g,'_'));
};

</script>
  <script src="rowColors_ready.js">
// Excel export helpers
function exportSheet(rows, filename) {
  const ws = XLSX.utils.json_to_sheet(rows);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
  XLSX.writeFile(wb, filename + ".xlsx", {bookType: "xlsx"});
}

// "Download Full Data" button
document.getElementById('export-full').onclick = () => {
  const rows = [];
  events.forEach(e => {
    const k = keyOf(e);
    for (let r = 1; r <= classLists[currentClass].length; r++) {
      const st = dataStore[currentClass][r][k] || {timeliness:'timely',completion:'complete'};
      rows.push({
        Class: currentClass,
        Roll: r,
        Name: classLists[currentClass][r-1],
        Date: e.date,
        Chapter: e.chapter,
        Timeliness: capitalize(st.timeliness),
        Completion: capitalize(st.completion)
      });
    }
  });
  exportSheet(rows, currentClass + "_full_data");
};

// "Download Chapter" button (latest event)
document.getElementById('export-chapter').onclick = () => {
  if (!events.length) return alert('No chapters to export!');
  const e = events[events.length-1];
  const k = keyOf(e);
  const rows = [];
  for (let r = 1; r <= classLists[currentClass].length; r++) {
    const st = dataStore[currentClass][r][k] || {timeliness:'timely',completion:'complete'};
    rows.push({
      Class: currentClass,
      Roll: r,
      Name: classLists[currentClass][r-1],
      Date: e.date,
      Chapter: e.chapter,
      Timeliness: capitalize(st.timeliness),
      Completion: capitalize(st.completion)
    });
  }
  exportSheet(rows, currentClass + "_" + e.chapter.replace(/\s+/g,'_'));
};

</script>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body { font-family: 'Poppins', sans-serif; background:#eef1f5; color:#333; padding:20px; }
    .card { max-width:1000px; margin:auto; border-radius:12px; overflow:hidden; box-shadow:0 4px 16px rgba(0,0,0,0.1); background:#fff; }
    .header { background:#0069d9; color:#fff; padding:20px; text-align:center; }
    .header h1 { margin:0; font-size:1.8rem; }
    .controls { padding:15px 20px; display:flex; flex-wrap:wrap; gap:10px; align-items:center; background:#fafafa; border-bottom:1px solid #ddd; justify-content:center; }
    .controls select, .controls input, .controls button { padding:8px 12px; font-size:1rem; border:1px solid #ccc; border-radius:5px; }
    .controls button { cursor:pointer; border:none; color:#fff; transition:background .2s; }
    #add-date { background:#28a745; } #add-date:hover { background:#218838; }
    #export-full { background:#17a2b8; } #export-full:hover { background:#138496; }
    #export-chapter { background:#ffc107; color:#212529; } #export-chapter:hover { background:#e0a800; }
    #reset-all { background:#dc3545; } #reset-all:hover { background:#c82333; }
    .table-wrapper { overflow-x:auto; background:#fff; }
    table { width:100%; border-collapse:collapse; min-width:700px; }
    th, td { border:1px solid #e0e0e0; padding:8px; text-align:center; }
    thead th { background:#0069d9; color:#fff; position:sticky; top:0; z-index:2; }
    tbody tr:nth-child(odd) { background:#f9f9f9; }
    select.status { padding:4px; border-radius:4px; border:1px solid #aaa; font-size:0.9rem; width:100%; }
    select.status-timely { background-color:#d4edda!important; color:#155724!important; }
    select.status-complete { background-color:#d4edda!important; color:#155724!important; }
    select.status-delayed { background-color:#f8d7da!important; color:#721c24!important; }
    select.status-incomplete { background-color:#f8d7da!important; color:#721c24!important; }
    select.status-absent { background-color:#e2e3e5!important; color:#343a40!important; }
    select.status-complete:disabled, select.status-incomplete:disabled { background-color:#e2e3e5!important; color:#343a40!important; cursor:not-allowed; opacity:0.7; }
    .remove-date { background:none; border:none; color:#fff; margin-left:5px; font-weight:bold; cursor:pointer; }
    .remove-date:hover { color:#ffcccc; }
    .student-row { transition: background-color 0.3s; }
  </style>
</head>
<body>

<div class="card">
  <div class="header"><h1>Notebook Submission Tracker</h1></div>
  <div class="controls">
    <select id="class-select"></select>
    <input type="date" id="date-input">
    <input type="text" id="chapter-input" placeholder="Chapter name">
    <button id="add-date">Add Date & Chapter</button>
    <button id="export-full">Download Full Data</button>
    <button id="export-chapter">Download Chapter</button>
    <button id="reset-all">Reset All</button>
  </div>
  <div class="table-wrapper">
    <table id="tracker-table"></table>
  </div>
</div>

<script>
let currentClass, events = [], dataStore = {};

function keyOf(e){ return `${e.date}|${e.chapter}`; }
function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

function initClass(cls){
  currentClass = cls;
  if(!dataStore[cls]){
    dataStore[cls] = {};
    classLists[cls].forEach((_,i)=> dataStore[cls][i+1]={});
  }
  render();
}

function render(){
  const tbl = document.getElementById('tracker-table');
  tbl.innerHTML = '';
  const thead = document.createElement('thead'), hr=document.createElement('tr');
  hr.innerHTML = '<th>Roll</th><th>Name</th>' +
    events.map(e=>`<th>${e.date} — ${e.chapter}<br><small>(Timeliness)</small>
                    <button class="remove-date" data-key="${keyOf(e)}">×</button></th>
                    <th><small>Completion</small></th>`).join('');
  thead.appendChild(hr); tbl.appendChild(thead);

  const tbody = document.createElement('tbody');
  const names = classLists[currentClass], colors = rowColors[currentClass]||{};
  names.forEach((name, idx)=>{
    const r = idx+1;
    const tr = document.createElement('tr');
    tr.classList.add('student-row');
    if(colors[r]) tr.style.backgroundColor = colors[r];
    let html = `<td>${r}</td><td>${name}</td>`;
    events.forEach(e=>{
      const k = keyOf(e);
      const st = dataStore[currentClass][r][k] || {timeliness:'timely',completion:'complete'};
      html += `<td><select class="status status-${st.timeliness}" data-type="timeliness" data-roll="${r}" data-key="${k}">
        <option value="timely"${st.timeliness==='timely'?' selected':''}>Timely</option>
        <option value="delayed"${st.timeliness==='delayed'?' selected':''}>Delayed</option>
        <option value="absent"${st.timeliness==='absent'?' selected':''}>Absent</option>
      </select></td>`;
      const dis = st.timeliness==='absent'?' disabled':'';
      html += `<td><select class="status status-${st.completion}" data-type="completion" data-roll="${r}" data-key="${k}"${dis}>
        <option value="complete"${st.completion==='complete'?' selected':''}>Complete</option>
        <option value="incomplete"${st.completion==='incomplete'?' selected':''}>Incomplete</option>
      </select></td>`;
    });
    tr.innerHTML = html; tbody.appendChild(tr);
  });
  tbl.appendChild(tbody);

  thead.querySelectorAll('.remove-date').forEach(btn=>btn.onclick=()=>{
    const k=btn.dataset.key;
    events=events.filter(e=>keyOf(e)!==k);
    Object.keys(dataStore[currentClass]).forEach(r=> delete dataStore[currentClass][r][k]);
    render();
  });

  tbody.querySelectorAll('select.status').forEach(sel=>sel.onchange=()=>{
    const r=+sel.dataset.roll, k=sel.dataset.key, t=sel.dataset.type, v=sel.value;
    const st = dataStore[currentClass][r][k] || {};
    if(t==='timeliness'){ st.timeliness = v; if(v==='absent') st.completion = 'incomplete'; }
    else st.completion = v;
    dataStore[currentClass][r][k] = st;
    render();
  });
}

// Wiring controls
document.getElementById('class-select').onchange = e=>initClass(e.target.value);
document.getElementById('add-date').onclick = ()=>{
  const d = document.getElementById('date-input').value, ch = document.getElementById('chapter-input').value.trim();
  if(!d||!ch) return alert('Select date & enter chapter');
  const e = {date:d,chapter:ch}, k = keyOf(e);
  events.push(e);
  Object.keys(dataStore[currentClass]).forEach(r=> dataStore[currentClass][r][k]={timeliness:'timely',completion:'complete'});
  render();
};
document.getElementById('reset-all').onclick = ()=>{
  if(!confirm('Clear this class data?')) return;
  events = []; dataStore[currentClass]={};
  classLists[currentClass].forEach((_,i)=> dataStore[currentClass][i+1]={});
  render();
};

document.addEventListener('DOMContentLoaded', ()=>{
  Object.keys(classLists).forEach(c=>{
    const o = document.createElement('option');
    o.value = c; o.textContent = c;
    document.getElementById('class-select').appendChild(o);
  });
  initClass(Object.keys(classLists)[0]);
});

// Excel export helpers
function exportSheet(rows, filename) {
  const ws = XLSX.utils.json_to_sheet(rows);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
  XLSX.writeFile(wb, filename + ".xlsx", {bookType: "xlsx"});
}

// "Download Full Data" button
document.getElementById('export-full').onclick = () => {
  const rows = [];
  events.forEach(e => {
    const k = keyOf(e);
    for (let r = 1; r <= classLists[currentClass].length; r++) {
      const st = dataStore[currentClass][r][k] || {timeliness:'timely',completion:'complete'};
      rows.push({
        Class: currentClass,
        Roll: r,
        Name: classLists[currentClass][r-1],
        Date: e.date,
        Chapter: e.chapter,
        Timeliness: capitalize(st.timeliness),
        Completion: capitalize(st.completion)
      });
    }
  });
  exportSheet(rows, currentClass + "_full_data");
};

// "Download Chapter" button (latest event)
document.getElementById('export-chapter').onclick = () => {
  if (!events.length) return alert('No chapters to export!');
  const e = events[events.length-1];
  const k = keyOf(e);
  const rows = [];
  for (let r = 1; r <= classLists[currentClass].length; r++) {
    const st = dataStore[currentClass][r][k] || {timeliness:'timely',completion:'complete'};
    rows.push({
      Class: currentClass,
      Roll: r,
      Name: classLists[currentClass][r-1],
      Date: e.date,
      Chapter: e.chapter,
      Timeliness: capitalize(st.timeliness),
      Completion: capitalize(st.completion)
    });
  }
  exportSheet(rows, currentClass + "_" + e.chapter.replace(/\s+/g,'_'));
};

</script>

</body>
</html>
